import React, { useState, useEffect } from 'react';
import { motion } from 'framer-motion';
import { ChevronLeft, ChevronRight, BookOpen, Check, Home } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Card, CardContent } from '@/components/ui/card';
import { useAuth } from '@/contexts/AuthContext';
import { getSupabase } from '@/lib/supabaseClient';
import { queryWithRetry } from '@/lib/supabase-utils';

interface Lesson {
  id: number;
  title: string;
  content: string;
}

const lessons: Lesson[] = [
  {
    id: 1,
    title: 'Старт для фрилансеров',
    content: `Фриланс — это не просто "сидеть дома и делать задачки из интернета".
Это целый набор навыков: как общаться, как держать слово, как не перегореть и при этом зарабатывать.

Представь, что ты выходишь на новую работу. Только вместо офиса — платформа, вместо начальника — клиенты, вместо оклада — твой личный результат.

Начнём с трёх базовых шагов.

1. Оформи профиль как витрину

Клиент видит тебя через профиль. Если он пустой или кривой — шансов мало.

Аватар: не мем, не рандомная картинка. Либо твоё лицо, либо аккуратный нейтральный образ.

Описание: кто ты и что делаешь в 2–4 предложениях.
Пример: «Front-end разработчик, делаю адаптивные сайты и лендинги. Люблю аккуратный интерфейс, читаемый код и быстрые загрузки.»

Навыки: технологии, направления (React, дизайн лендингов, копирайтинг, монтаж, таргет и т.п.).

Примеры работ: даже если проектов мало, лучше честно показать 2–3 штуки, чем ничего.

2. Выбери 1–2 сильных направления

Ошибка новичка — «я всё умею, берите всё подряд».
Так не работает. На старте лучше быть понятным, чем «универсальным солдатом».

Выбери то, что реально умеешь и можешь делать качественно.

Не разбрасывайся на шесть услуг сразу.

Остальное можно докрутить позже, когда наберёшься опыта и отзывов.

3. Настрой стартовые цены

Твоя цель на старте — не "сорвать куш", а набрать первые успешные проекты.

Посмотри, какие цены у других в твоей нише.

Поставь немного ниже рынка, чтобы мотивировать клиентов выбрать именно тебя.

Не падай до абсурда: слишком дёшево вызывает недоверие.

Главная мысль:
Фриланс — это марафон. Сегодня ты ставишь аватар и пишешь первое описание. Через пару месяцев у тебя уже профиль с отзывами и портфолио. Ты уже на старте — дальше просто двигаться вперёд.`
  },
  {
    id: 2,
    title: 'Как получить первый заказ',
    content: `Первый заказ всегда ощущается как "невозможно". Кажется, что без отзывов никто не выберет. Но есть схема, которая реально работает.

1. Временная скидка на старте

Это не про "дёшево навсегда", а про осознанный старт.

Сделай цену на 20–30% ниже среднего по рынку.

Откровенно напиши: сейчас набираешь первые отзывы, поэтому цена ниже.

Как только появятся 3–5 успешных сделок — поднимаешь прайс.

Клиенту легче рискнуть с новичком, когда цена приятная и честно объяснена.

2. Пиши живые отклики, не копипасту

Шаблонные сообщения типа «Здравствуйте, готов выполнить ваш заказ» клиенты видят десятками. Они ничего о тебе не говорят.

Сделай так:

Перескажи задачу своими словами: покажи, что ты понял суть.

Коротко опиши, как будешь решать: 2–3 пункта.

Дай пример похожей работы (если есть).

Покажи план: "Сначала сделаем это, затем это. Срок — такой-то."

Клиент должен почувствовать, что ты ответил именно ему, а не "кому угодно".

3. Дай маленький бонус

Сильный ход на старте — добавить бонус, который не ломает тебя, но радует клиента.

Примеры:

«Сделаю одну дополнительную правку бесплатно.»

«Запишу короткое видео с объяснением результата.»

«Сделаю адаптацию под мобильные как бонус.»

Это повышает ощущение ценности, даже при небольшой цене.

4. Реагируй быстро

Во фрилансе скорость ответа — огромный плюс.

Старайся отвечать на новые запросы в течение часа (когда ты онлайн).

Если занят, напиши: «Сейчас не у компьютера, смогу подробно ответить через …».

Клиенту важно видеть, что исполнитель живой и на связи.

Главная мысль:
Первые заказы — самые сложные. Но как только появляется первый успешный кейс и отзыв, дальше становится гораздо легче: у тебя уже есть доказательство, что ты умеешь работать.`
  },
  {
    id: 3,
    title: 'Как общаться с клиентами',
    content: `Клиент запоминает не только результат, но и опыт работы с тобой. Можно сделать круто, но общаться так, что человек не захочет возвращаться.

1. Пиши коротко и структурно

Никто не любит огромные простыни текста без абзацев.

Делай короткие абзацы.

В начале письма отвечай на главный вопрос.

Если нужно — используй списки: «Смотрите, предлагаю так: 1)… 2)… 3)…».

Клиент должен легко "сканировать" сообщение глазами.

2. Уточняющие вопросы — это профессионально

Молчаливый исполнитель, который просто кивает и делает "как понял", часто попадает в переделки.

Примеры вопросов:

«Какой для вас приоритет: скорость или максимальное качество?»

«Есть ли примеры работ/сайтов/дизайнов, которые вам нравятся?»

«До какого числа вам критично получить результат?»

Вопросы показывают, что ты не работаешь "наугад".

3. Всегда проговаривай сроки и этапы

Очень простая, но сильная формулировка:

«Задачу понял. Срок — 2 дня. Сегодня сделаю структуру, завтра — финальный вариант и отправлю вам на проверку.»

Сразу понятно:

ты понял задачу;

называешь срок;

описываешь этапы.

4. Если не уверен — уточни, а не угадывай

Лучше спросить лишний раз, чем сделать "не то".

«Я правильно понимаю, что…?» — и дальше формулируешь своё понимание.

Если что-то туманно, перепиши это своими словами и попроси подтвердить или поправить.

Главная мысль:
Общение = половина успеха. С тобой должно быть легко: понятно, вежливо, без драм и истерик. Тогда люди возвращаются.`
  },
  {
    id: 4,
    title: 'Как оформлять услугу',
    content: `Карточка услуги — это твой мини-магазин. Клиент заходит и за пару секунд решает: остаться или пролистать дальше.

1. Название — максимально простое

Не нужно "креатива ради креатива".

«Сделаю лендинг на React»

«Смонтирую вертикальное видео для TikTok/Reels»

«Настрою рекламную кампанию в Google/Яндекс»

Человек должен прочитать и сразу понять, что именно ты предлагаешь.

2. Описание — 3–5 предложений, не больше

Структура:

Что ты делаешь.

Для кого это.

Какой результат клиент получит.

Пример:

«Сделаю адаптивный лендинг под вашу услугу или продукт. Помогу структурировать блоки, чтобы пользователю было понятно, куда нажать. В результате вы получите аккуратный сайт, который нормально смотрится и на телефоне, и на компьютере.»

3. Преимущества — зачем именно ты

Клиент выбирает не только по цене.

Примеры преимуществ:

«Быстро отвечаю и остаюсь на связи.»

«Делаю правки до финального результата.»

«Объясняю сложные вещи простым языком.»

Пусть человек увидит, что с тобой удобно, а не только "дёшево".

4. Пакеты: базовый, стандарт, премиум

Сделай три уровня:

Базовый — минимум услуг, низкая цена.

Стандарт — оптимальный вариант по цене/объёму.

Премиум — "под ключ" + максимум внимания и бонусов.

Так клиент может выбрать по бюджету и задачам, а не просто "да/нет".

Главная мысль:
Человек должен понять твою услугу за 5 секунд: что ты делаешь, сколько примерно это стоит и чем ты отличаешься. Всё остальное — дополнение.`
  },
  {
    id: 5,
    title: 'Как сделать крутое портфолио',
    content: `Портфолио — это не "свалка работ", а тщательно собранная витрина.

1. Выбери 3–6 лучших работ

Много — не значит лучше.

Убираем всё старое, сильно слабое и стыдное.

Оставляем то, что не стыдно показать клиенту прямо сейчас.

Можно сделать разделение по типам: "Дизайн", "Сайты", "Реклама" и т.д.

2. Сделай нормальные скриншоты

Визуал очень решает.

Скриншоты без лишних вкладок браузера, уведомлений, панели задач.

По возможности — одинаковый размер и формат.

Можно сделать коллаж: "до/после".

3. Описывай не только что сделал, но и зачем

Хороший кейс = мини-история:

Задача: чего хотел клиент?

Что ты сделал: какие решения принял?

Результат: что улучшилось (даже если без цифр, можно описать качественно).

Пример:

«Задача: обновить старый лендинг школы, сделать его современным и удобным для мобильных.
Что сделал: переработал структуру, добавил блоки с отзывами, сделал адаптивную вёрстку.
Результат: клиент отмечает, что людям стало проще находить нужную информацию, увеличилось число заявок с телефона.»

4. Если нет коммерческих работ — делай учебные

Это нормально. Важно — честность.

Придумываешь условного клиента (кафе, небольшой бренд, блогер).

Делаешь под него сайт, дизайн, текст, рекламу — как будто это реальный заказ.

Честно подписываешь: «Учебная работа для демонстрации навыков.»

Клиенту важен твой уровень, а не то, платили ли тебе за эту конкретную работу.

Главная мысль:
Лучше 3–4 сильных оформленных кейса, чем 15 "как попало". Портфолио — это твой главный аргумент, когда человек выбирает между тобой и другим исполнителем.`
  },
  {
    id: 6,
    title: 'Как устроить цены',
    content: `Цена — это не только "сколько ты хочешь". Это ещё и сигнал: кто ты и какой уровень даёшь.

1. Привяжи цену к опыту

Грубо, но честно:

Новичок → немного ниже рынка.

Средний уровень → среднерыночные цены.

Профи → выше рынка, но с понятной аргументацией (опыт, результаты, скорость).

2. Раздели задачи по размерам

Удобно мысленно разложить:

~10$ — мини-задача (мелкие правки, один простой экран, короткий текст).

30–50$ — средняя задача (лендинг, серия баннеров, сценарий ролика, монтаж одного видео).

100$+ — крупный проект (сайт с несколькими страницами, сложный дизайн, рекламная связка).

Так тебе самому проще ориентироваться и не "стрелять цены из головы".

3. Используй доп.опции и апселлы

Не запихивай всё в базовый пакет.

«Срочное выполнение» — за доплату.

«Дополнительные правки сверх включённых» — отдельным пунктом.

«Полный пакет: дизайн + вёрстка / текст + настройка рекламы» — за повышенную цену.

Так клиенты могут собрать "свою" конфигурацию.

4. Не застревай в демпинге

Ошибочно держать низкие цены слишком долго.

Низкая цена на старте = инструмент набрать отзывы.

Как только у тебя появляются стабильные заказы и хорошие оценки — поднимай прайс.

Уважай своё время и навыки. Тогда и клиенты будут уважать.

Главная мысль:
Цена должна быть понятной, честной и логичной. Ты сам должен уметь объяснить, почему работа стоит именно столько — и не стесняться этого.`
  },
  {
    id: 7,
    title: 'Как работать через TaskHub',
    content: `TaskHub — твоя рабочая площадка. Здесь ты находишь заказы, общаешься с клиентами, получаешь оплату и решаешь спорные моменты.

1. Настрой профиль и начни искать задания

Заполни профиль: фото, описание, навыки, портфолио.

Перейди в раздел с заданиями и отфильтруй по своим направлениям.

Откликайся на те задачи, которые реально можешь выполнить качественно.

2. Понимай, как работает безопасная сделка

Безопасная сделка — твой защитный щит.

Клиент создаёт заказ и вносит оплату через платформу.

Деньги резервируются и не попадают сразу к тебе или клиенту.

После того как работа сдана и клиент её подтверждает, средства переходят на твой баланс.

Так минимизируются риски и для тебя, и для заказчика.

3. Внутренняя валюта и баланс

Все оплаты за проекты попадают на твой внутренний баланс TaskHub.

Оттуда ты можешь выводить деньги на поддерживаемые платёжные системы.

История операций помогает контролировать доходы и понимать динамику.

4. Общение и файлы — только через платформу

Важные договорённости фиксируй в чате TaskHub.

Все файлы, версии и итоговые результаты отправляй через платформу.

В случае спора модерация видит историю переписки и отправленных файлов.

5. Как действовать при проблемах (спор)

Иногда бывает так: клиент пропал, не принимает работу или требует то, о чём не договаривались.

Не паниковать и не хамить — это важное правило.

Сначала спокойно объясняешь ситуацию в чате, ссылаясь на договорённости.

Если не помогает — открываешь спор (по правилам платформы).

Подробно описываешь: что обещал, что сделал, что отправлял, какие были сроки.

Главная мысль:
Работать через TaskHub — значит максимально использовать защиту платформы. Не выводить коммуникацию и оплату "в сторону", чтобы потом не защищать себя в одиночку.`
  },
  {
    id: 8,
    title: 'Как не попадать на мошенников',
    content: `Твои нервы, время и деньги дороже любого сомнительного "супервыгодного" предложения.

1. Не выходи из платформы без причины

Самое простое золотое правило:

Общение — в чате TaskHub.

Оплата — через безопасную сделку.

Файлы — через платформу.

Мошенникам часто нужно именно вытащить тебя "вне системы", где у тебя нет защиты.

2. Не отправляй полноценную работу без оплаты

Предпросмотр — да, финал — после.

Покажи превью (например, с водяным знаком или в уменьшенном кач-ве).

Чётко оговаривай: полный файл — после оплаты/подтверждения этапа.

3. Осторожно со ссылками и файлами

Не переходи по странным укороченным ссылкам.

Не скачивай подозрительные архивы "для примера".

Если что-то вызывает сомнение — всегда можно спросить: "Зачем вам это?".

4. Не принимай оплату "напрямую"

Даже если предлагают "чуть больше, но на карту".

Такие схемы лишают тебя защиты платформы.

Если что-то пойдёт не так, у TaskHub не будет доступа к переписке и операции.

5. Не отправляй личные данные

Настоящему клиенту не нужны:

фото паспорта,

сканы карты,

коды из SMS,

доступ к твоим личным аккаунтам.

6. Узнавай токсичных клиентов заранее

Некоторые признаки:

Постоянное давление и оскорбления.

Фразочки вроде: «Да это фигня работа, сделаешь за 5 минут».

Пытается выбить максимум за минимальные деньги, ещё и с агрессией.

Иногда лучший выбор — вежливо попрощаться и не тратить свои нервы.

Главная мысль:
Безопасность — это не страх, а привычка. Пара простых правил сильно снижает риски и оставляет время на нормальных клиентов.`
  },
  {
    id: 9,
    title: 'Как выполнять работу быстро и качественно',
    content: `Скорость без качества не нужна. Качество без разумных сроков — тоже. Нужен баланс.

1. Сначала черновик — потом детали

Не ныряй сразу в идеальную вёрстку/отполированный дизайн/идеальный текст.

Сначала: структура, макет, прототип, план.

Покажи это клиенту: «Вот так вижу общую картину, двигаемся?»

После одобрения — уходишь в глубину и детали.

Это экономит кучу времени на "ой, я хотел совсем иначе".

2. Делай мини-отчёты по ходу

Клиенту важно понимать, что работа двигается.

В конце дня/этапа: «Сегодня сделал это, завтра возьмусь за это».

Это снижает тревогу клиента и укрепляет доверие.

3. Не стартуй, пока не собрал вводные

Хаос на входе → хаос на выходе.

Сначала собираешь все материалы: тексты, логотипы, доступы, ТЗ.

Уточняешь спорные и непонятные моменты.

Только потом начинаешь делать.

4. Работай блоками по 40–60 минут

Вечно сидеть "под 6 часов подряд" — путь к выгоранию и падению качества.

Ставишь таймер на 40–60 минут фокуса.

Потом делаешь перерыв 5–10 минут.

Так мозг меньше устает, а концентрация держится лучше.

5. Держи чистоту в том, что делаешь

Это про уважение к себе и к клиенту.

В коде — понятные имена, аккуратная структура, без лишнего мусора.

В дизайне — порядок в слоях и группах.

В текстах — структурирование, подзаголовки, читабельность.

Главная мысль:
Люди возвращаются за качеством. А качество — это не магия. Это внимание к мелочам, стабильный процесс и уважение к срокам.`
  },
  {
    id: 10,
    title: 'Как получить постоянных клиентов',
    content: `Самое ценное во фрилансе — не разовые заказы, а люди, которые возвращаются снова и снова.

1. Всегда держи слово

Звучит банально, но это основа.

Обещал срок — сделай всё, чтобы уложиться.

Понимаешь, что не успеваешь — предупреди заранее, а не в последний момент.

Клиенты очень ценят предсказуемость.

2. Делай чуть больше, чем от тебя ждут

Не надо перерабатывать бесплатно, но можно добавить маленький "сервис".

Засунуть дополнительный вариант оформления.

Подправить мелочь, которая улучшает результат.

Записать короткое голосовое/видео с пояснениями.

Это создаёт ощущение, что ты не просто "отстрелял задачу", а реально заботишься о результате.

3. Общайся уважительно, даже когда сложно

Споры, правки, недопонимания — это часть работы.

Не срывайся, даже если клиент странный.

Пиши спокойно, чётко, без лишней эмоциональной нагрузки.

Фокусируйся на решении, а не на выяснении, кто правее.

4. Отмечай старых клиентов "особо"

Можешь сделать небольшую скидку постоянному клиенту.

Можешь брать его задачи в приоритет.

Можешь предложить абонемент/долгосрочное сотрудничество.

Клиент должен чувствовать, что лояльность имеет смысл.

5. Предлагай идеи, а не просто выполняй команды

Самый ценный фрилансер — тот, кто думает.

Если видишь, как можно улучшить проект — скажи об этом.

Предложи простые доработки, которые увеличат результат.

Стань не просто исполнителем, а человеком, который помогает бизнесу клиента расти.

Главная мысль:
Постоянные клиенты — это не случайность. Это результат того, как ты работаешь, общаешься, держишь сроки и смотришь на задачи. Выстраивай с людьми нормальные рабочие отношения — и они сами будут возвращаться.`
  }
];

const pageVariants = {
  initial: { opacity: 0, y: 16 },
  in: { opacity: 1, y: 0 },
  out: { opacity: 0, y: -16 }
};

const pageTransition = { type: 'spring' as const, stiffness: 140, damping: 20, mass: 0.9 };

export default function LearningPage() {
  const { user } = useAuth();
  const [currentLessonId, setCurrentLessonId] = useState(1);
  const [completedLessons, setCompletedLessons] = useState<number[]>([]);
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    const loadProgress = async () => {
      if (!user) {
        setIsLoading(false);
        return;
      }

      const { data, error } = await queryWithRetry(() =>
        getSupabase()
          .from('profiles')
          .select('completed_lessons')
          .eq('id', user.id)
          .maybeSingle()
      );

      if (!error && data) {
        setCompletedLessons(data.completed_lessons || []);
      }
      setIsLoading(false);
    };

    loadProgress();
  }, [user?.id]);

  const currentLesson = lessons.find(l => l.id === currentLessonId) || lessons[0];
  const currentIndex = lessons.findIndex(l => l.id === currentLessonId);

  const goToLesson = async (lessonId: number) => {
    if (!completedLessons.includes(lessonId)) {
      const newCompleted = [...completedLessons, lessonId];
      setCompletedLessons(newCompleted);

      if (user) {
        const learningCompleted = newCompleted.length === 10;
        await queryWithRetry(() =>
          getSupabase()
            .from('profiles')
            .update({
              completed_lessons: newCompleted,
              learning_completed: learningCompleted
            })
            .eq('id', user.id)
        );
      }
    }
    setCurrentLessonId(lessonId);
    window.scrollTo({ top: 0, behavior: 'smooth' });
  };

  const goToPrevious = () => {
    if (currentIndex > 0) {
      goToLesson(lessons[currentIndex - 1].id);
    }
  };

  const goToNext = async () => {
    if (currentIndex < lessons.length - 1) {
      if (!completedLessons.includes(currentLessonId)) {
        const newCompleted = [...completedLessons, currentLessonId];
        setCompletedLessons(newCompleted);

        if (user) {
          const learningCompleted = newCompleted.length === 10;
          await queryWithRetry(() =>
            getSupabase()
              .from('profiles')
              .update({
                completed_lessons: newCompleted,
                learning_completed: learningCompleted
              })
              .eq('id', user.id)
          );
        }
      }
      goToLesson(lessons[currentIndex + 1].id);
    }
  };

  const goToHome = () => {
    window.location.hash = '/';
  };

  return (
    <motion.div
      key="learning"
      initial="initial"
      animate="in"
      exit="out"
      variants={pageVariants}
      transition={pageTransition}
      className="min-h-screen bg-background"
    >
      <div className="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-10">
        <div className="mb-8">
          <h1 className="text-3xl font-bold tracking-tight mb-2">Обучение</h1>
          <p className="text-muted-foreground">Пройди уроки и стань успешным фрилансером</p>
        </div>

        <div className="grid grid-cols-1 lg:grid-cols-4 gap-6">
          <aside className="lg:col-span-1">
            <Card className="sticky top-4">
              <CardContent className="p-4">
                <div className="flex items-center gap-2 mb-4 pb-3 border-b">
                  <BookOpen className="h-5 w-5 text-[#3F7F6E]" />
                  <h2 className="font-semibold">Уроки</h2>
                </div>
                <div className="space-y-1">
                  {lessons.map((lesson) => {
                    const isActive = lesson.id === currentLessonId;
                    const isCompleted = completedLessons.includes(lesson.id);

                    return (
                      <button
                        key={lesson.id}
                        onClick={() => goToLesson(lesson.id)}
                        className={`w-full text-left px-3 py-2.5 rounded-lg transition-colors flex items-center gap-2 ${
                          isActive
                            ? 'bg-[#3F7F6E] text-white'
                            : isCompleted
                            ? 'bg-[#EFFFF8] text-[#3F7F6E] hover:bg-[#E0F9F0]'
                            : 'hover:bg-muted'
                        }`}
                      >
                        <div className={`flex-shrink-0 w-6 h-6 rounded-full border-2 flex items-center justify-center text-xs font-semibold ${
                          isActive
                            ? 'border-white'
                            : isCompleted
                            ? 'border-[#3F7F6E] bg-[#3F7F6E] text-white'
                            : 'border-gray-300'
                        }`}>
                          {isCompleted ? <Check className="h-4 w-4" /> : lesson.id}
                        </div>
                        <span className="text-sm flex-1 line-clamp-2">{lesson.title}</span>
                      </button>
                    );
                  })}
                </div>
                <div className="mt-4 pt-3 border-t text-sm text-muted-foreground">
                  Пройдено: {completedLessons.length} из {lessons.length}
                </div>
              </CardContent>
            </Card>
          </aside>

          <main className="lg:col-span-3">
            <Card>
              <CardContent className="p-8">
                <div className="mb-6">
                  <div className="text-sm text-[#3F7F6E] font-medium mb-2">
                    Урок {currentLesson.id} из {lessons.length}
                  </div>
                  <h2 className="text-2xl font-bold mb-4">{currentLesson.title}</h2>
                </div>

                <div className="space-y-5">
                  {currentLesson.content.split('\n\n').map((paragraph, index) => {
                    const text = paragraph.trim();

                    if (text.startsWith('Главная мысль:')) {
                      return (
                        <div key={index} className="mt-8 p-6 bg-gradient-to-r from-[#EFFFF8] to-[#E0F9F0] rounded-xl border-l-4 border-[#3F7F6E]">
                          <div className="font-bold text-[#3F7F6E] text-lg mb-2">Главная мысль</div>
                          <p className="text-base leading-relaxed text-gray-800">{text.replace('Главная мысль:', '').trim()}</p>
                        </div>
                      );
                    }

                    if (/^\d+\.\s+/.test(text)) {
                      const parts = text.split('\n');
                      const heading = parts[0];
                      const content = parts.slice(1).join('\n');

                      return (
                        <div key={index} className="mt-6">
                          <h3 className="text-xl font-bold text-gray-900 mb-3">{heading}</h3>
                          {content && (
                            <div className="text-base leading-relaxed text-gray-700 whitespace-pre-line pl-4 border-l-2 border-gray-200">
                              {content}
                            </div>
                          )}
                        </div>
                      );
                    }

                    if (text.includes('Примеры:') || text.includes('Пример:') || text.includes('Структура:') || text.includes('Правила:') || text.includes('Некоторые признаки:')) {
                      return (
                        <div key={index} className="pl-4 border-l-2 border-[#6FE7C8]">
                          <p className="text-base leading-relaxed text-gray-700 whitespace-pre-line">{text}</p>
                        </div>
                      );
                    }

                    if (text.startsWith('«') || text.includes('→')) {
                      return (
                        <div key={index} className="pl-6 py-2 italic text-gray-600 text-base leading-relaxed">
                          {text}
                        </div>
                      );
                    }

                    return (
                      <p key={index} className="text-base leading-relaxed text-gray-700 whitespace-pre-line">
                        {text}
                      </p>
                    );
                  })}
                </div>

                <div className="flex items-center justify-between mt-8 pt-6 border-t">
                  <Button
                    variant="outline"
                    onClick={goToPrevious}
                    disabled={currentIndex === 0}
                    className="gap-2"
                  >
                    <ChevronLeft className="h-4 w-4" />
                    Назад
                  </Button>

                  <div className="text-sm text-muted-foreground">
                    {currentIndex + 1} / {lessons.length}
                  </div>

                  {currentIndex === lessons.length - 1 ? (
                    <Button
                      onClick={goToHome}
                      className="gap-2 bg-[#3F7F6E] hover:bg-[#2F6F5E]"
                    >
                      <Home className="h-4 w-4" />
                      На главную
                    </Button>
                  ) : (
                    <Button
                      onClick={goToNext}
                      className="gap-2 bg-[#3F7F6E] hover:bg-[#2F6F5E]"
                    >
                      Далее
                      <ChevronRight className="h-4 w-4" />
                    </Button>
                  )}
                </div>
              </CardContent>
            </Card>
          </main>
        </div>
      </div>
    </motion.div>
  );
}
